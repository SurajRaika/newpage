<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minimal Search</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Phosphor Icons CDN for filled icons -->
    <script src="https://unpkg.com/@phosphor-icons/web@2.1.1/dist/phosphor.js"></script>
    <style>
        /* Define CSS variables for colors, updated to black and white palette */
        :root {
            --bg-dark: #1a1a1a; /* Very dark gray, almost black */
            --bg-medium: #2a2a2a; /* Dark gray */
            --border-dark: #444444; /* Medium dark gray for borders */
            --text-light: #f0f0f0; /* Off-white for main text */
            --text-medium: #cccccc; /* Light gray for secondary text/hover */
            --text-dark: #888888; /* Medium gray for placeholders/hints */
            --focus-border: #ffffff; /* White for focus/highlight */
            --selected-bg: #555555; /* Dark gray for selected radio background */
            --selected-dot: #ffffff; /* White for radio dot */
            --active-line-color: #ffffff; /* Directly use white for active line */
        }

        /* Global transition for all elements for smoother UI */
        * {
            transition: all 0.2s ease-out;
        }

        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 1rem;
            box-sizing: border-box;
        }

        /* Container Wrapper */
        .container-wrapper {
            width: 100%;
            max-width: 40rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            position: relative;
        }

        /* Top Row */
        .top-row {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start; /* Default to left-align */
            width: 100%;
        }

        @media (min-width: 640px) {
            .top-row {
                flex-direction: row;
                justify-content: space-between;
                align-items: center; /* Center for desktop */
            }
        }

        /* Time Info */
        .time-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-medium);
            font-size: 0.875rem;
            font-weight: 500;
            padding-left: 0;
            white-space: nowrap;
        }

        .time-icon {
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: var(--focus-border);
            color: var(--bg-dark);
        }

        .current-time {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-light);
        }

        /* Engine Selection */
        .engine-selection {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: 0.75rem;
            padding-left: 0.5rem;
            position: relative; /* Added for active-line positioning */
        }

        .engine-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            cursor: pointer;
            position: relative; /* Needed for radio button positioning */
            padding: 0.2rem 0;
            min-width: 4rem;
        }

        .engine-label .radio-text {
            font-weight: 500;
            color: var(--text-medium);
            white-space: nowrap;
            text-transform: uppercase;
            font-size: 0.75rem;
            padding: 0 0.25rem;
        }

        .engine-label:hover .radio-text {
            color: var(--text-light);
        }

        /* Hide the actual radio button visually */
        .custom-radio {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none;
        }

        /* Active line indicator - now a single element */
        #active-line {
            position: absolute;
            bottom: 0;
            height: 2px;
            background-color: var(--active-line-color);
            border-radius: 1px;
            transition: left 0.3s ease-out, width 0.3s ease-out; /* Sliding animation */
        }

        /* Remove individual active lines from labels */
        .engine-label .active-line {
            display: none;
        }

        /* Search Area Wrapper */
        .search-area-wrapper {
            display: flex;
            flex-direction: column;
            background-color: var(--bg-medium);
            border: 2px solid var(--border-dark);
            border-radius: 0.125rem;
            padding: 0.25rem; /* Made more compact */
            position: relative;
        }

        .search-area-wrapper:focus-within {
            border-color: var(--focus-border);
        }

        .search-form {
            width: 100%;
            flex-grow: 1;
            margin-top: 0;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            width: 100%;
        }

        .search-input {
            width: 100%;
            background-color: transparent;
            border: none;
            border-radius: 0;
            padding-top: 0.3rem; /* Made more compact */
            padding-bottom: 0.3rem; /* Made more compact */
            padding-left: 0.5rem;
            padding-right: 2.5rem; /* Adjusted for smaller button area */
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.5rem;
        }

        .search-input::placeholder {
            color: var(--text-dark);
        }

        .search-input:focus {
            outline: none;
        }

        .search-button {
            position: absolute;
            right: 0;
            margin-right: 0.5rem; /* Made more compact */
            color: var(--text-medium);
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-button:hover {
            color: var(--text-light);
        }

        .search-icon {
            width: 1.2rem; /* Slightly smaller icon */
            height: 1.2rem; /* Slightly smaller icon */
        }

        /* Bottom Section */
        .bottom-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: flex-start; /* Default to left-align */
            width: 100%;
        }

        @media (min-width: 640px) {
            .bottom-section {
                flex-direction: row;
                justify-content: space-between;
                align-items: center; /* Center for desktop */
            }
        }

        /* Goals Container */
        .goals-container {
            width: 100%;
            flex-grow: 1;
            max-width: none;
            padding-right: 0; /* Removed horizontal padding */
            display: grid; /* Use grid for layout */
            grid-template-columns: 1fr 1fr; /* Two equal columns */
            gap: 1rem; /* Keep gap for spacing */
            align-items: flex-start; /* Align items to the start of their grid area */
        }

        /* Unified styling for both actual goal items and add-goal-prompt */
        .goal-item,
        .add-goal-prompt {
            display: flex;
            /* Changed to row for icon + text alignment */
            flex-direction: row;
            align-items: center; /* Vertically center icon and text */
            gap: 0.5rem; /* Space between icon and text */
            padding: 0.3rem 0; /* Removed horizontal padding */
            border: 1px solid var(--border-dark); /* Solid border for actual goals, dashed for add-goal-prompt */
            border-radius: 0.125rem;
            color: var(--text-light); /* Default text color */
            font-size: 0.75rem; /* Smaller font size */
            font-weight: 500;
            min-height: 2.2rem; /* Ensure a minimum height */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            white-space: nowrap; /* Prevent text wrapping */
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            justify-content: flex-start; /* Default to left-align text */
        }

        .goal-item:hover,
        .add-goal-prompt:hover {
            border-color: var(--focus-border);
            background-color: var(--bg-medium); /* Slightly darker on hover */
            color: var(--text-light);
        }

        /* Specific style for the add-goal-prompt to have a dashed border */
        .add-goal-prompt {
            border-style: dashed; /* Dashed border for the add goal prompt */
            /* justify-content: center; REMOVED from here, moved to .goal-item, .add-goal-prompt */
            /* align-items: center; This can stay, vertically centers icon and text */
            color: var(--text-medium); /* Muted color for prompt */
        }

        /* Style for the icon within goal cards */
        .goal-icon {
            font-size: 1.1em; /* Slightly larger than text for visibility */
            color: var(--text-medium); /* Muted color for the icon */
            flex-shrink: 0; /* Prevent icon from shrinking */
            margin-left: 0.6rem; /* Add left margin to icon for visual spacing */
        }

        .goal-item:hover .goal-icon,
        .add-goal-prompt:hover .goal-icon {
            color: var(--text-light); /* Icon brightens on hover */
        }

        .goal-title {
            font-size: 0.75rem; /* Match parent font size */
            font-weight: 500;
            color: var(--text-light); /* Ensure light text color */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1; /* Allow title to take remaining space */
        }

        .time-since {
            font-size: 0.7rem;
            font-weight: 400;
            color: var(--text-medium);
            white-space: nowrap;
            margin-left: auto; /* Push time-since to the right */
            flex-shrink: 0; /* Prevent time-since from shrinking */
            margin-right: 0.6rem; /* Add right margin to time-since for visual spacing */
        }


        /* Daily Progress Container */
        .daily-progress-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
            padding-left: 0.5rem;
        }

        @media (min-width: 640px) {
            .daily-progress-container {
                width: auto;
                padding-left: 0;
            }
        }

        .progress-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-medium);
            text-transform: uppercase;
            white-space: nowrap;
        }

        .progress-bar-wrapper {
            background-color: var(--border-dark);
            border-radius: 0.125rem;
            height: 0.5rem;
            width: 100%;
            overflow: hidden;
        }

        .progress-bar {
            background-color: var(--focus-border);
            height: 100%;
            width: 0%;
            border-radius: 1px;
        }

        /* Blank Screen Overlay */
        #blank-screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            transition: opacity 0.2s ease-out;
            display: flex; /* Added for centering content */
            align-items: center; /* Added for centering content */
            justify-content: center; /* Added for centering content */
        }

        @media (prefers-color-scheme: dark) {
            #blank-screen-overlay {
                background-color: var(--bg-dark);
            }
        }

        @media (prefers-color-scheme: light) {
            #blank-screen-overlay {
                background-color: white;
            }
        }

        /* Loading Indicator */
        #loading-indicator {
            width: 50px; /* Small width */
            height: 4px; /* Thin line */
            background-color: var(--focus-border); /* White color */
            border-radius: 2px; /* Rounded corners */
            opacity: 0; /* Start invisible */
            transform: translateX(-50px); /* Start off-screen to the left */
            animation: slide-fade 1s infinite cubic-bezier(0.65, 0.05, 0.36, 1); /* Fast, smooth animation */
        }

        @keyframes slide-fade {
            0% {
                opacity: 0;
                transform: translateX(-50px);
            }
            25% {
                opacity: 1;
                transform: translateX(0);
            }
            75% {
                opacity: 1;
                transform: translateX(50px);
            }
            100% {
                opacity: 0;
                transform: translateX(100px);
            }
        }


        /* Search History Section */
        #search-history-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            background-color: transparent;
            border: none;
            border-top: 2px solid var(--focus-border);
            border-radius: 0;
            padding-top: 1rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            padding-bottom: 0.5rem;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            box-sizing: border-box;
            margin-top: 1rem;
        }

        #search-history-section.show {
            max-height: 20rem;
            opacity: 1;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-dark);
            margin-bottom: 0.5rem;
        }

        .history-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
        }

        .clear-history-button {
            background: none;
            border: 1px solid var(--border-dark);
            color: var(--text-medium);
            padding: 0.25rem 0.75rem;
            border-radius: 0.125rem;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }

        .clear-history-button:hover {
            background-color: var(--border-dark);
            color: var(--text-light);
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: calc(20rem - 3rem);
            overflow-y: auto;
            /* Minimalistic Scrollbar Styles */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: var(--border-dark) transparent; /* Firefox: thumb color track color */
        }

        /* Webkit browsers (Chrome, Safari) scrollbar styles */
        .history-list::-webkit-scrollbar {
            width: 6px; /* width of the scrollbar */
        }

        .history-list::-webkit-scrollbar-track {
            background: transparent; /* color of the tracking area */
        }

        .history-list::-webkit-scrollbar-thumb {
            background-color: var(--border-dark); /* color of the scroll thumb */
            border-radius: 10px; /* roundness of the scroll thumb */
            border: 1px solid var(--bg-medium); /* creates padding around scroll thumb */
        }


        .history-item {
            display: flex;
            align-items: center;
            padding: 0.4rem 0;
            border-bottom: 1px dashed var(--border-dark);
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
            gap: 0.5rem;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item:hover {
            background-color: var(--bg-dark);
        }

        .history-query {
            flex-grow: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-engine-tag {
            font-size: 0.65rem;
            background-color: var(--border-dark);
            color: var(--text-light);
            padding: 0.1rem 0.4rem;
            border-radius: 0.125rem;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .history-timestamp {
            font-size: 0.7rem;
            color: var(--text-medium);
            margin-left: auto;
            flex-shrink: 0;
        }

        .open-link-button {
            background: none;
            border: none;
            color: var(--text-medium);
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.5rem;
            flex-shrink: 0;
        }

        .open-link-button:hover {
            color: var(--text-light);
        }

        /* Goal Input Popup (Modal) - Original for 2 goals - HIDDEN BY DEFAULT */
        #goal-input-overlay {
            display: none; /* Hide this modal by default */
        }

        /* New Edit Goal Section (like history) */
        #edit-goal-section {
            position: fixed; /* Fixed position at the top */
            top: 0;
            left: 0;
            width: 100vw; /* Full viewport width */
            height: 100vh; /* Full viewport height for overlay effect */
            background-color: rgba(0, 0, 0, 0.3); /* Subtle dark overlay */
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: flex-start; /* Align inner modal to the top */
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out; /* Only opacity transition for the section */
            padding: 0; /* No padding on the section itself */
            margin: 0; /* No margin on the section itself */
            box-sizing: border-box;
        }

        #edit-goal-section.show {
            opacity: 1;
            pointer-events: auto;
            /* No transform here, handled by inner modal */
        }

        /* Inner modal content for the goal editor */
        .edit-goal-modal {
            background-color: var(--bg-medium); /* Background for the editor itself */
            border: 1px solid var(--border-dark); /* Less bright default border */
            border-radius: 0.125rem;
            padding: 0.5rem; /* Reduced padding for a more minimalistic look */
            display: flex;
            flex-direction: row; /* Horizontal layout for input and buttons */
            align-items: center;
            gap: 0.5rem; /* Reduced gap between input and buttons */
            width: 90%; /* Take full width of its container */
            max-width: 40rem; /* Max width for the editor */
            box-shadow: none; /* Remove default shadow */
            margin-top: 1rem; /* Margin from the top of the fixed section */
            transform: translateY(-20px); /* Initial off-screen position for the modal */
            transition: transform 0.3s ease-out, border-color 0.2s ease, box-shadow 0.2s ease; /* Transition for modal */
        }

        #edit-goal-section.show .edit-goal-modal {
            transform: translateY(1rem); /* Slide into view */
        }

        /* Highlight when the input within the modal is focused */
        .edit-goal-modal:focus-within {
            border-color: var(--focus-border); /* White border on focus */
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.2); /* Subtle glow */
        }

        .edit-goal-modal h3 {
            display: none; /* Hide the title in this compact editor */
        }

        .edit-goal-modal label {
            color: var(--text-medium);
            font-size: 0.875rem;
            display: flex;
            flex-direction: column; /* Keep label and input stacked if needed, but flex-grow will make input take space */
            gap: 0.25rem;
            flex-grow: 1; /* Allow input to grow */
        }

        .edit-goal-modal input[type="text"] {
            background-color: var(--bg-dark);
            border: 1px solid var(--border-dark);
            border-radius: 0.125rem;
            padding: 0.4rem 0.6rem; /* Reduced padding for input */
            color: var(--text-light);
            font-size: 0.9rem;
            width: 100%;
            box-sizing: border-box;
        }

        .edit-goal-modal input[type="text"]:focus {
            outline: none;
            border-color: var(--focus-border);
        }

        .edit-goal-modal .button-group {
            display: flex;
            flex-direction: row; /* Horizontal buttons */
            gap: 0.25rem; /* Reduced gap between buttons */
            margin-top: 0;
            align-items: center; /* Align buttons vertically in the row */
            margin-left: auto; /* Push buttons to the right */
        }

        .edit-goal-modal button {
            background-color: var(--focus-border);
            color: var(--bg-dark);
            padding: 0.3rem 0.6rem; /* Reduced padding for compact buttons */
            border: none;
            border-radius: 0.125rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.75rem; /* Smaller font size for buttons */
            transition: background-color 0.2s ease;
            white-space: nowrap; /* Prevent text wrapping */
        }

        .edit-goal-modal button.delete-button {
            background-color: var(--border-dark);
            color: var(--text-light);
        }

        .edit-goal-modal button:hover {
            background-color: var(--text-medium);
        }

        .edit-goal-modal button.delete-button:hover {
            background-color: #ff4d4d;
            color: white;
        }

        /* Goal Context Menu */
        .context-menu {
            position: absolute;
            background-color: var(--bg-medium);
            border: 1px solid var(--border-dark);
            border-radius: 0.125rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            display: none;
            flex-direction: column;
            min-width: 120px;
            padding: 0.25rem 0;
        }

        .context-menu.show {
            display: flex;
        }

        .context-menu-item {
            padding: 0.5rem 1rem;
            color: var(--text-light);
            font-size: 0.875rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .context-menu-item:hover {
            background-color: var(--border-dark);
        }

        /* --- Mobile Specific Styles (max-width: 640px) --- */
        @media (max-width: 640px) {
            body {
                padding: 0.5rem; /* Reduce overall padding */
            }

            .container-wrapper {
                gap: 0.75rem; /* Smaller gap between sections */
            }

            .top-row {
                flex-direction: column; /* Stack elements vertically */
                align-items: flex-start; /* ALIGN TO LEFT ON MOBILE */
                gap: 0.75rem; /* Smaller gap */
            }

            .time-info {
                font-size: 0.75rem; /* Smaller font for time info */
                padding-left: 0.5rem; /* Add small left padding to time info */
            }

            .time-icon {
                width: 1.2rem; /* Smaller icon */
                height: 1.2rem; /* Smaller icon */
            }

            .current-time {
                font-size: 0.65rem; /* Even smaller font for current time */
            }

            .engine-selection {
                gap: 0.5rem; /* Smaller gap between engine labels */
                padding-left: 0.5rem; /* Align group of radios to the left */
                justify-content: flex-start; /* Align group of radios to the left */
            }

            .engine-label {
                min-width: 3rem; /* Smaller min-width for labels */
                padding: 0.1rem 0; /* Reduced padding */
            }

            .engine-label .radio-text {
                font-size: 0.65rem; /* Smaller font for radio text */
                padding: 0 0.1rem; /* Reduced padding */
            }

            .search-area-wrapper {
                padding: 0.15rem; /* Even more compact search bar */
            }

            .search-input {
                padding-top: 0.2rem;
                padding-bottom: 0.2rem;
                padding-left: 0.4rem;
                padding-right: 2rem; /* Adjusted for smaller button area */
                font-size: 0.9rem; /* Smaller font for search input */
            }

            .search-button {
                margin-right: 0.3rem; /* More compact button margin */
            }

            .search-icon {
                width: 1rem; /* Even smaller icon */
                height: 1rem; /* Even smaller icon */
            }

            .bottom-section {
                flex-direction: column; /* Stack elements vertically */
                align-items: flex-start; /* ALIGN TO LEFT ON MOBILE */
                gap: 0.75rem; /* Smaller gap */
            }

            .goals-container {
                grid-template-columns: 1fr; /* Single column on mobile for goals */
                gap: 0.75rem; /* Smaller gap */
                padding-right: 0;
            }

            .goal-item,
            .add-goal-prompt {
                padding: 0.2rem 0; /* Reduced padding */
                min-height: 2rem; /* Smaller min-height */
                justify-content: flex-start; /* ALIGN TEXT TO LEFT ON MOBILE */
            }

            .goal-icon {
                font-size: 1em; /* Slightly smaller icon */
                margin-left: 0.4rem; /* Reduced margin */
            }

            .goal-title {
                font-size: 0.7rem; /* Smaller font for goal title */
            }

            .time-since {
                font-size: 0.6rem; /* Smaller font for time since */
                margin-right: 0.4rem; /* Reduced margin */
            }

            .daily-progress-container {
                padding-left: 0.5rem; /* Keep left padding for alignment with other left-aligned items */
                width: 100%; /* Ensure full width */
            }

            .progress-label {
                font-size: 0.7rem; /* Smaller font for progress label */
            }

            .progress-bar-wrapper {
                height: 0.4rem; /* Thinner progress bar */
            }

            #search-history-section {
                padding-top: 0.75rem; /* Reduced padding */
                padding-left: 0.5rem; /* Maintain left padding */
                padding-right: 0.5rem; /* Maintain right padding */
                padding-bottom: 0.25rem;
                margin-top: 0.75rem; /* Reduced margin */
            }

            .history-header {
                padding-bottom: 0.3rem; /* Reduced padding */
                margin-bottom: 0.3rem; /* Reduced margin */
            }

            .history-title {
                font-size: 0.8rem; /* Smaller font for history title */
            }

            .clear-history-button {
                padding: 0.2rem 0.5rem; /* Reduced padding */
                font-size: 0.7rem; /* Smaller font */
            }

            .history-item {
                padding: 0.3rem 0; /* Reduced padding */
                font-size: 0.8rem; /* Smaller font */
            }

            .history-engine-tag {
                font-size: 0.55rem; /* Even smaller font */
                padding: 0.05rem 0.3rem; /* Reduced padding */
            }

            .history-timestamp {
                font-size: 0.6rem; /* Even smaller font */
                margin-left: 0.3rem; /* Reduced margin */
            }

            .open-link-button {
                margin-left: 0.3rem; /* Reduced margin */
            }

            .edit-goal-modal {
                padding: 0.4rem; /* Reduced padding */
                gap: 0.4rem; /* Reduced gap */
                margin-top: 0.5rem; /* Reduced margin */
            }

            .edit-goal-modal input[type="text"] {
                padding: 0.3rem 0.5rem; /* Reduced padding */
                font-size: 0.8rem; /* Smaller font */
            }

            .edit-goal-modal button {
                padding: 0.25rem 0.5rem; /* Reduced padding */
                font-size: 0.65rem; /* Smaller font */
            }
        }
    </style>
</head>
<body>
    <!-- Blank screen overlay for transition -->
    <div id="blank-screen-overlay">
        <div id="loading-indicator"></div>
    </div>

    <!-- Goal Context Menu (Right-click) -->
    <div id="goal-context-menu" class="context-menu">
        <div class="context-menu-item" data-action="completed">Completed</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
    </div>

    <div class="container-wrapper">
        <!-- New Edit Goal Section - For single goal edit, appears from top -->
        <div id="edit-goal-section" class="edit-goal-section">
            <div class="edit-goal-modal">
                <label for="edit-goal-input">
                    <input type="text" id="edit-goal-input" placeholder="Edit your goal title">
                </label>
                <div class="button-group">
                    <button id="edit-goal-action-button"></button> <!-- This will be Save or Completed -->
                    <button id="edit-goal-delete-button" class="delete-button">Delete</button>
                </div>
            </div>
        </div>

        <!-- Top row for time info and engine selection -->
        <div class="top-row">
            <div id="time-info" class="time-info">
                <!-- Phosphor Icon element -->
                <i id="time-icon" class="ph"></i>
                <span id="current-time" class="current-time"></span>
            </div>
            <!-- Search Engine Selection -->
            <div id="engine-selection" class="engine-selection">
                <label class="engine-label" title="Switch to Google search (G)">
                    <input type="radio" name="engine" value="google" class="custom-radio" checked>
                    <span class="radio-text">Google</span>
                    <!-- <div class="active-line"></div> Removed individual active lines -->
                </label>
                <label class="engine-label" title="Switch to Perplexity search (P)">
                    <input type="radio" name="engine" value="perplexity" class="custom-radio">
                    <span class="radio-text">Perplexity</span>
                    <!-- <div class="active-line"></div> -->
                </label>
                <label class="engine-label" title="Switch to YouTube search (Y)">
                    <input type="radio" name="engine" value="youtube" class="custom-radio">
                    <span class="radio-text">YouTube</span>
                    <!-- <div class="active-line"></div> -->
                </label>
                <label class="engine-label" title="Switch to ChatGPT search (C)">
                    <input type="radio" name="engine" value="chatgpt" class="custom-radio">
                    <span class="radio-text">ChatGPT</span>
                    <!-- <div class="active-line"></div> -->
                </label>
                <label class="engine-label" title="View search history (H)">
                    <input type="radio" name="engine" value="history" class="custom-radio">
                    <span class="radio-text">History</span>
                    <!-- <div class="active-line"></div> -->
                </label>
                <div id="active-line"></div> <!-- Single active line for sliding effect -->
            </div>
        </div>

        <div class="search-area-wrapper" title="Press / to focus, Esc to unfocus">
            <form id="search-form" class="search-form">
                <div class="input-wrapper">
                    <input
                        type="text"
                        id="search-input"
                        name="query"
                        class="search-input"
                        placeholder="Search the web..."
                        autocomplete="off"
                    />
                    <button type="submit" class="search-button" aria-label="Search">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
                            <path d="m21 21-4.35-4.35m0 0A7.5 7.5 0 1 0 6.5 6.5a7.5 7.5 0 0 0 10.2 10.2Z"/>
                        </svg>
                    </button>
                </div>
            </form>
        </div>

        <div class="bottom-section">
            <!-- Goals section -->
            <div class="goals-container" id="goals-container">
                <!-- Goals or "Click here to set up" message will be rendered here -->
            </div>
            <!-- Existing section for "DAY REMAINING" progress bar -->
            <div class="daily-progress-container">
                <div class="progress-label">DAY REMAINING: <span id="day-remaining-percent"></span>%</div>
                <div class="progress-bar-wrapper">
                    <div id="day-progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <!-- New Search History Section -->
        <div id="search-history-section" class="history-section">
            <div class="history-header">
                <span class="history-title">Search History</span>
                <button id="clear-history-button" class="clear-history-button">Clear All</button>
            </div>
            <ul id="history-list" class="history-list">
                <!-- History items will be dynamically added here by JavaScript -->
            </ul>
        </div>
    </div>

    <script>
        // --- Function Definitions (All moved to top for scope) ---

        // CDN-hosted Phosphor Icons (filled variant) - Defined early as it's a constant
        const timeOfDayIconClasses = {
            morning: 'ph-fill ph-sunrise',
            m_day: 'ph-fill ph-sun',
            evening: 'ph-fill ph-sunset',
            night: 'ph-fill ph-moon',
        };

        const searchEnginePlaceholders = {
            google: "Search Google...",
            perplexity: "Search Perplexity...",
            youtube: "Search YouTube...",
            chatgpt: "Search ChatGPT...",
            history: "View search history or search Google..." // Special case for history
        };

        function updateTimeOfDayInfo() {
            const now = new Date();
            const hour = now.getHours();
            let iconClass;
            let timeOfDayText;

            if (hour >= 5 && hour < 12) {
                iconClass = timeOfDayIconClasses.morning;
                timeOfDayText = 'Morning';
            } else if (hour >= 12 && hour < 18) {
                iconClass = timeOfDayIconClasses.m_day;
                timeOfDayText = 'Day';
            } else if (hour >= 18 && hour < 21) {
                iconClass = timeOfDayIconClasses.evening;
                timeOfDayText = 'Evening';
            } else {
                iconClass = timeOfDayIconClasses.night;
                timeOfDayText = 'Night';
            }

            // Options for date and time formatting
            const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };
            const timeOptions = { hour: 'numeric', minute: '2-digit', hour12: true };

            const formattedDate = now.toLocaleDateString('en-US', dateOptions);
            const formattedTime = now.toLocaleTimeString('en-US', timeOptions);

            if (timeIconElement && currentTimeSpan) {
                timeIconElement.className = 'ph ' + iconClass;
                // Combine date, time, and time of day text
                currentTimeSpan.textContent = `${formattedDate}, ${formattedTime} (${timeOfDayText})`;
            }
        }

        function updateProgressBar(type, percent) {
            let progressBar;
            let percentText;

            if (type === 'day') {
                progressBar = document.getElementById('day-progress-bar');
                percentText = document.getElementById('day-remaining-percent');
            }

            if (progressBar && percentText) {
                const clampedPercent = Math.max(0, Math.min(100, percent));
                progressBar.style.width = `${clampedPercent}%`;
                percentText.textContent = clampedPercent.toFixed(1); // Display with one decimal place
            }
        }

        function updateDayProgress() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth();
            const currentDay = now.getDate();

            const startOfActiveDay = new Date(currentYear, currentMonth, currentDay, 6, 0, 0); // 6 AM
            const endOfActiveDay = new Date(currentYear, currentMonth, currentDay, 22, 0, 0); // 10 PM

            if (now < startOfActiveDay) {
                updateProgressBar('day', 100); // Before active day, show 100% remaining
                return;
            }

            if (now > endOfActiveDay) {
                updateProgressBar('day', 0); // After active day, show 0% remaining
                return;
            }

            const totalMillisecondsInActiveDay = endOfActiveDay.getTime() - startOfActiveDay.getTime();
            const elapsedMillisecondsInActiveDay = now.getTime() - startOfActiveDay.getTime();

            const elapsedPercent = (elapsedMillisecondsInActiveDay / totalMillisecondsInActiveDay) * 100;
            const remainingPercent = 100 - elapsedPercent;

            updateProgressBar('day', remainingPercent);
        }

        function formatTimeAgo(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);

            if (seconds < 60) return `${seconds}s ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days < 30) return `${days}d ago`;
            const months = Math.floor(days / 30.44);
            if (months < 12) return `${months}mo ago`;
            const years = Math.floor(months / 12);
            return `${years}y ago`;
        }

        function getGoals() {
            try {
                const goalsString = localStorage.getItem('userGoals');
                return goalsString ? JSON.parse(goalsString) : [];
            } catch (e) {
                console.error("Error parsing goals from localStorage:", e);
                return [];
            }
        }

        function saveGoals(goalsArray) {
            try {
                localStorage.setItem('userGoals', JSON.stringify(goalsArray));
            } catch (e) {
                console.error("Error saving goals to localStorage:", e);
            }
        }

        function renderGoals() {
            const userGoals = getGoals(); // Get only user-defined goals

            goalsContainer.innerHTML = ''; // Clear existing goals/button

            const maxVisibleSlots = 2; // Always aim for 2 slots

            for (let i = 0; i < maxVisibleSlots; i++) {
                if (userGoals[i]) {
                    // Render existing user goal
                    const goalItem = document.createElement('div');
                    goalItem.className = 'goal-item'; /* Apply unified styling */
                    goalItem.dataset.index = i;
                    goalItem.innerHTML = `
                        <i class="ph-fill ph-clipboard-text goal-icon"></i>
                        <span class="goal-title">${userGoals[i].text}</span>
                        <span class="time-since">${userGoals[i].creationTime ? formatTimeAgo(userGoals[i].creationTime) : ''}</span>
                    `;
                    goalItem.addEventListener('click', (e) => showEditGoalPopup(e, i, false));
                    goalItem.addEventListener('contextmenu', (e) => showGoalContextMenu(e, i, false));
                    goalsContainer.appendChild(goalItem);
                } else {
                    // Render "Click here to add goal" card
                    const setupPrompt = document.createElement('div');
                    setupPrompt.className = 'add-goal-prompt'; /* Apply unified styling */
                    setupPrompt.innerHTML = `
                        <i class="ph-fill ph-clipboard-text goal-icon"></i>
                        <span>Click here to add your next goal</span>
                    `;
                    setupPrompt.addEventListener('click', (e) => {
                        showEditGoalPopup(e, -1, true); // isNewGoal true for new goal
                    });
                    goalsContainer.appendChild(setupPrompt);
                }
            }
        }

        let currentEditGoalIndex = -1;
        let isEditingNewGoal = false; // Renamed from isEditingDefaultGoal for clarity
        let originalGoalText = '';

        function showEditGoalPopup(e, index, isNewGoal = false) { // Renamed isDefault to isNewGoal
            e.stopPropagation();
            currentEditGoalIndex = index;
            isEditingNewGoal = isNewGoal;

            let goalText = '';
            if (!isNewGoal) { // If it's an existing goal
                const currentGoals = getGoals();
                const goalToEdit = currentGoals[index];
                goalText = goalToEdit ? goalToEdit.text : '';
            }
            // If isNewGoal is true (clicked "add goal" prompt), goalText remains empty, which is correct for new goal.

            originalGoalText = goalText;
            editGoalInput.value = goalText;
            editGoalSection.classList.add('show');
            editGoalInput.focus();

            updateActionButtonText();
        }

        function hideEditGoalPopup() {
            editGoalSection.classList.remove('show');
            currentEditGoalIndex = -1;
            isEditingNewGoal = false;
            originalGoalText = '';
        }

        function updateActionButtonText() {
            if (editGoalInput.value.trim() !== originalGoalText.trim()) {
                editGoalActionButton.textContent = "Save";
            } else {
                editGoalActionButton.textContent = "Completed";
            }
        }

        function handleEditGoalAction() {
            if (editGoalActionButton.textContent === "Save") {
                handleSaveGoal();
            } else if (editGoalActionButton.textContent === "Completed") {
                handleCompleteGoal();
            }
        }

        function handleSaveGoal() {
            const newText = editGoalInput.value.trim();
            if (!newText) {
                console.warn("Goal title cannot be empty.");
                return;
            }

            let userGoals = getGoals(); // Get all current goals

            if (isEditingNewGoal) {
                // If it was a new goal being added
                userGoals.push({ text: newText, creationTime: new Date().toISOString() });
            } else {
                // If an existing user goal was edited, update it
                if (currentEditGoalIndex !== -1 && currentEditGoalIndex < userGoals.length) {
                    userGoals[currentEditGoalIndex].text = newText;
                }
            }
            saveGoals(userGoals);
            renderGoals();
            hideEditGoalPopup();
        }

        function handleCompleteGoal() {
            if (isEditingNewGoal) { // If it's the "add goal" prompt, just close
                hideEditGoalPopup();
                return;
            }

            let userGoals = getGoals();
            if (currentEditGoalIndex !== -1 && currentEditGoalIndex < userGoals.length) {
                userGoals.splice(currentEditGoalIndex, 1);
                saveGoals(userGoals);
                renderGoals();
            }
            hideEditGoalPopup();
        }

        function handleDeleteGoal() {
            if (isEditingNewGoal) { // If it's the "add goal" prompt, just close
                hideEditGoalPopup();
                return;
            }

            let userGoals = getGoals();
            if (currentEditGoalIndex !== -1 && currentEditGoalIndex < userGoals.length) {
                userGoals.splice(currentEditGoalIndex, 1);
                saveGoals(userGoals);
                renderGoals();
            }
            hideGoalContextMenu(); // Ensure context menu is hidden
            hideEditGoalPopup(); // Ensure edit popup is hidden
        }


        function showGoalContextMenu(e, index, isNewGoal = false) { // Renamed isDefault to isNewGoal
            e.preventDefault();
            if (isNewGoal) return; // Right-click does nothing on the "add goal" prompt

            const currentGoals = getGoals();
            if (index < 0 || index >= currentGoals.length) return;

            goalContextMenu.classList.add('show');
            goalContextMenu.style.left = `${e.clientX}px`;
            goalContextMenu.style.top = `${e.clientY}px`;
            goalContextMenu.dataset.goalIndex = index;
        }

        function hideGoalContextMenu() {
            goalContextMenu.classList.remove('show');
            goalContextMenu.removeAttribute('data-goal-index');
        }

        function handleContextMenuAction(action) {
            const index = parseInt(goalContextMenu.dataset.goalIndex, 10);
            if (isNaN(index)) return;

            let userGoals = getGoals();
            if (index >= 0 && index < userGoals.length) {
                if (action === 'completed' || action === 'delete') {
                    userGoals.splice(index, 1);
                    saveGoals(userGoals);
                    renderGoals();
                }
            }
            hideGoalContextMenu();
        }

        function getSearchHistory() {
            try {
                const history = localStorage.getItem('searchHistory');
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error("Error parsing search history from localStorage:", e);
                return [];
            }
        }

        function saveSearchHistory(history) {
            try {
                localStorage.setItem('searchHistory', JSON.stringify(history));
            } catch (e) {
                console.error("Error saving search history to localStorage:", e);
            }
        }

        function addSearchToHistory(query, engine) {
            const history = getSearchHistory();
            const now = new Date();
            const timestamp = now.toISOString();
            history.unshift({ query, engine, timestamp });
            if (history.length > 20) {
                history.pop();
            }
            saveSearchHistory(history);
            renderSearchHistory();
        }

        function renderSearchHistory() {
            const history = getSearchHistory();
            historyList.innerHTML = '';

            if (history.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'No search history yet.';
                li.style.color = 'var(--text-dark)';
                li.style.textAlign = 'center';
                li.style.padding = '1rem';
                historyList.appendChild(li);
                return;
            }

            history.forEach(item => {
                const li = document.createElement('li');
                li.className = 'history-item';

                const engineTag = document.createElement('span');
                engineTag.className = 'history-engine-tag';
                engineTag.textContent = item.engine;

                const querySpan = document.createElement('span');
                querySpan.className = 'history-query';
                querySpan.textContent = item.query;

                const timestampSpan = document.createElement('span');
                timestampSpan.className = 'history-timestamp';
                timestampSpan.textContent = formatTimeAgo(item.timestamp);

                const openLinkButton = document.createElement('button');
                openLinkButton.className = 'open-link-button';
                openLinkButton.setAttribute('title', `Open in ${item.engine}`);
                openLinkButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="open-link-icon">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/>
                    </svg>
                `;
                openLinkButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    let url = '';
                    switch (item.engine) {
                        case 'google':
                            url = `https://www.google.com/search?q=${encodeURIComponent(item.query)}`;
                            break;
                        case 'perplexity':
                            url = `https://www.perplexity.ai/search?q=${encodeURIComponent(item.query)}`;
                            break;
                        case 'youtube':
                            url = `https://www.youtube.com/results?search_query=${encodeURIComponent(item.query)}`;
                            break;
                        case 'chatgpt':
                            url = `https://chat.openai.com/chat?q=${encodeURIComponent(item.query)}`;
                            break;
                        default:
                            url = `https://www.google.com/search?q=${encodeURIComponent(item.query)}`;
                            break;
                    }
                    window.open(url, '_blank');
                });

                li.appendChild(engineTag);
                li.appendChild(querySpan);
                li.appendChild(timestampSpan);
                li.appendChild(openLinkButton);

                historyList.appendChild(li);
            });
        }

        function updateGoalTimeSince() {
            renderGoals();
        }

        function updateActiveLinePosition() {
            const currentRadio = document.querySelector('input[name="engine"]:checked');
            const activeLineElement = document.getElementById('active-line');
            if (currentRadio && activeLineElement) {
                const parentLabel = currentRadio.closest('.engine-label');
                if (parentLabel) {
                    // Get the position and size relative to the parent .engine-selection
                    const parentRect = engineSelection.getBoundingClientRect();
                    const labelRect = parentLabel.getBoundingClientRect();

                    activeLineElement.style.left = `${labelRect.left - parentRect.left}px`;
                    activeLineElement.style.width = `${labelRect.width}px`;
                }
            }
        }

        function updateActiveLineAndSections() {
            let historySelected = false;
            radioButtons.forEach(radio => {
                if (radio.checked) {
                    // Update search input placeholder based on selected engine
                    searchInput.placeholder = searchEnginePlaceholders[radio.value];
                    if (radio.value === 'history') {
                        historySelected = true;
                    }
                }
            });

            updateActiveLinePosition(); // Call this to update the sliding line

            if (searchHistorySection) {
                if (historySelected) {
                    searchHistorySection.classList.add('show');
                    renderSearchHistory();
                } else {
                    searchHistorySection.classList.remove('show');
                }
            }
        }


        // --- Element References (Declared after functions) ---
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const radioButtons = document.querySelectorAll('input[name="engine"]');
        const timeIconElement = document.getElementById('time-icon');
        const currentTimeSpan = document.getElementById('current-time');
        const blankScreenOverlay = document.getElementById('blank-screen-overlay');
        const engineSelection = document.getElementById('engine-selection'); // Reference to the engine selection container

        const goalsContainer = document.getElementById('goals-container');
        const goalContextMenu = document.getElementById('goal-context-menu');

        const editGoalSection = document.getElementById('edit-goal-section');
        const editGoalInput = document.getElementById('edit-goal-input');
        const editGoalActionButton = document.getElementById('edit-goal-action-button');
        const editGoalDeleteButton = document.getElementById('edit-goal-delete-button');


        const searchHistorySection = document.getElementById('search-history-section');
        const historyList = document.getElementById('history-list');
        const clearHistoryButton = document.getElementById('clear-history-button');

        // Global flag to track if Ctrl/Cmd is pressed
        let isCtrlPressed = false;


        // --- Event Listeners and Initial Calls ---

        // Event listener for context menu items
        goalContextMenu.addEventListener('click', (e) => {
            const action = e.target.dataset.action;
            if (action) {
                handleContextMenuAction(action);
            }
        });

        // Hide context menu and edit goal popup if clicked anywhere outside the modal
        document.addEventListener('click', (e) => {
            if (!goalContextMenu.contains(e.target) && goalContextMenu.classList.contains('show')) {
                hideGoalContextMenu();
            }
            // If editGoalSection is shown and the click target is the editGoalSection itself (the overlay)
            // or if the click is outside the editGoalModal but within the editGoalSection
            if (editGoalSection.classList.contains('show') && !editGoalModal.contains(e.target)) {
                hideEditGoalPopup();
            }
        });

        // Add escape key listener
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && editGoalSection.classList.contains('show')) {
                hideEditGoalPopup();
            }
        });

        // Add Enter key listener for the goal input
        editGoalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent default form submission or new line
                handleEditGoalAction();
            }
        });

        // Listen for changes on radio buttons to update the active line and sections visibility
        radioButtons.forEach(radio => {
            radio.addEventListener('change', updateActiveLineAndSections);
        });

        // Clear history button listener
        if (clearHistoryButton) {
            clearHistoryButton.addEventListener('click', () => {
                localStorage.removeItem('searchHistory');
                renderSearchHistory();
            });
        }

        // Track Ctrl/Cmd key state
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Control' || e.key === 'Meta') {
                isCtrlPressed = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'Control' || e.key === 'Meta') {
                isCtrlPressed = false;
            }
        });

        // --- Form Submission Logic ---
        searchForm.addEventListener('submit', function (e) {
            e.preventDefault();
            let query = searchInput.value.trim();
            if (!query) return;

            let selectedEngine = document.querySelector('input[name="engine"]:checked').value;

            // If history is active, switch to Google before searching
            if (selectedEngine === 'history') {
                const googleRadio = document.querySelector('input[name="engine"][value="google"]');
                if (googleRadio) {
                    googleRadio.checked = true;
                    googleRadio.dispatchEvent(new Event('change')); // Trigger change to update UI
                    selectedEngine = 'google'; // Update selectedEngine for the URL construction
                }
            }

            let url = '';

            switch (selectedEngine) {
                case 'google':
                    url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    break;
                case 'perplexity':
                    url = `https://www.perplexity.ai/search?q=${encodeURIComponent(query)}`;
                    break;
                case 'youtube':
                    url = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
                    break;
                case 'chatgpt':
                    url = `https://chat.openai.com/chat?q=${encodeURIComponent(query)}`;
                    break;
                // No default case needed as history is handled above and other cases are explicit
            }

            if (selectedEngine !== 'history') { // Only add to history if it's an actual search engine
                addSearchToHistory(query, selectedEngine);
            }

            blankScreenOverlay.style.opacity = '1';
            blankScreenOverlay.style.pointerEvents = 'auto';

            // Check if Ctrl key (or Cmd key on Mac) was pressed using the global flag
            if (isCtrlPressed) {
                window.open(url, '_blank');
            } else {
                setTimeout(() => {
                    window.location.href = url;
                }, 200);
            }
        });

        // --- Keyboard Shortcut Logic ---
        document.addEventListener('keydown', function(e) {
            const key = e.key.toLowerCase();

            const isInputActive = document.activeElement.tagName === 'INPUT' ||
                                  document.activeElement.tagName === 'TEXTAREA' ||
                                  document.activeElement.tagName === 'SELECT';

            if (!isInputActive && key !== '/' && key !== 'escape') {
                let targetEngine = null;

                if (key === 'p') {
                    targetEngine = 'perplexity';
                } else if (key === 'g') {
                    targetEngine = 'google';
                } else if (key === 'y') {
                    targetEngine = 'youtube';
                } else if (key === 'c') {
                    targetEngine = 'chatgpt';
                } else if (key === 'h') {
                    targetEngine = 'history';
                } else if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    e.preventDefault(); // Prevent default browser scrolling

                    const currentRadio = document.querySelector('input[name="engine"]:checked');
                    let currentIndex = -1;
                    // Get all engine labels to determine order for arrow key navigation
                    const engineLabels = Array.from(document.querySelectorAll('.engine-label input[name="engine"]'));

                    for (let i = 0; i < engineLabels.length; i++) {
                        if (engineLabels[i] === currentRadio) {
                            currentIndex = i;
                            break;
                        }
                    }

                    let newIndex = currentIndex;
                    if (e.key === 'ArrowRight') {
                        newIndex = (currentIndex + 1) % engineLabels.length;
                    } else if (e.key === 'ArrowLeft') {
                        newIndex = (currentIndex - 1 + engineLabels.length) % engineLabels.length;
                    }

                    if (newIndex !== currentIndex) {
                        engineLabels[newIndex].checked = true;
                        engineLabels[newIndex].dispatchEvent(new Event('change')); // Trigger change event
                    }
                    return; // Exit to prevent other keydown logic from interfering
                }

                if (targetEngine) {
                    e.preventDefault();
                    const radioToSelect = document.querySelector(`input[name="engine"][value="${targetEngine}"]`);
                    if (radioToSelect) {
                        radioToSelect.checked = true;
                        radioToSelect.dispatchEvent(new Event('change'));
                    }
                }
            }

            if (key === '/') {
                e.preventDefault();
                searchInput.focus();
            }

            if (key === 'escape' && document.activeElement === searchInput) {
                searchInput.blur();
            }
        });


        // Initial calls when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            updateDayProgress();
            updateGoalTimeSince();
            updateActiveLineAndSections(); // This will also set the initial placeholder
            updateTimeOfDayInfo();
            renderSearchHistory();

            // Element reference for editGoalModal
            window.editGoalModal = document.querySelector('#edit-goal-section .edit-goal-modal');

            // Event listener for the new combined action button
            if (editGoalActionButton) {
                editGoalActionButton.addEventListener('click', handleEditGoalAction);
            }
            // Event listener for the delete button
            if (editGoalDeleteButton) {
                editGoalDeleteButton.addEventListener('click', handleDeleteGoal);
            }
            // Event listener for input changes to update action button text
            if (editGoalInput) {
                editGoalInput.addEventListener('input', updateActionButtonText);
            }

            // Also update active line on window resize to handle responsive changes
            window.addEventListener('resize', updateActiveLinePosition);

            setInterval(updateDayProgress, 60 * 1000);
            setInterval(updateGoalTimeSince, 60 * 1000);
            setInterval(updateTimeOfDayInfo, 60 * 1000);
        });

        // Fix for blank screen on browser back button
        window.addEventListener('pageshow', (event) => {
            // Check if the page is being shown from the bfcache (back-forward cache)
            // This means the user navigated back to the page.
            if (event.persisted) {
                blankScreenOverlay.style.opacity = '0';
                blankScreenOverlay.style.pointerEvents = 'none';
            }
        });
    </script>
</body>
</html>

